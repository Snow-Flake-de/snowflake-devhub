services:
  bytestash:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: bytestash
    restart: unless-stopped
    ports:
      - "127.0.0.1:5000:5000"
    environment:
      BASE_PATH: ""
      ALLOWED_HOSTS: "snow-flake-systems.de,localhost,127.0.0.1"
      JWT_SECRET: "change-this-secret"
      TOKEN_EXPIRY: "24h"
      DEBUG: "false"
      DISABLE_ACCOUNTS: "false"
      DISABLE_INTERNAL_ACCOUNTS: "false"
      ALLOW_PASSWORD_CHANGES: "true"
      OIDC_ENABLED: "false"
      OIDC_DISPLAY_NAME: ""
      OIDC_ISSUER_URL: ""
      OIDC_CLIENT_ID: ""
      OIDC_CLIENT_SECRET: ""
      OIDC_SCOPES: ""
      BYTESTASH_DATA_PATH: "/home/bytestash"
    volumes:
      - /home/bytestash:/home/bytestash
    read_only: true
    tmpfs:
      - /tmp
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    pids_limit: 256
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget --spider -q http://127.0.0.1:5000/api/auth/config || exit 1"
        ]
      interval: 30s
      timeout: 5s
      retries: 5
      start_period: 20s
